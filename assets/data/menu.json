<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>قائمة لاسكالا</title>
  <style>
    :root { --bg:#0f1115; --card:#151924; --text:#e8ecf3; --muted:#9aa4b2; --chip:#232a3a; --accent:#7ac6ff; }
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,Segoe UI,Roboto,Tahoma,Arial;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;background:linear-gradient(180deg,#0f1115 70%,transparent);padding:20px 16px 10px;border-bottom:1px solid #1e2433}
    h1{margin:0;font-size:22px;letter-spacing:.2px}
    #wrap{max-width:1100px;margin:0 auto;padding:16px}
    .section{margin:18px 0 26px}
    .section h2{margin:0 0 12px;font-size:18px;color:#cdd6e3;border-right:4px solid var(--accent);padding-right:10px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
    .card{background:var(--card);border:1px solid #1e2433;border-radius:14px;padding:14px;min-height:170px;display:flex;flex-direction:column;gap:6px}
    .title{font-weight:700}
    .desc{color:var(--muted);font-size:13px;line-height:1.5}
    .meta{margin-top:auto;display:flex;gap:8px;align-items:center;justify-content:space-between}
    .price{background:var(--chip);padding:6px 10px;border-radius:999px;font-weight:700}
    .allergens{display:flex;flex-wrap:wrap;gap:6px}
    .tag{background:#1d2332;color:#b6c2d4;border:1px solid #2a3347;border-radius:999px;padding:3px 8px;font-size:12px}
    .error,.loading{background:#2a1120;border:1px solid #5a1c3a;color:#ffb6c1;padding:12px;border-radius:10px}
    .loading{background:#13202f;border-color:#203349;color:#b9dcff}
    footer{color:#758199;font-size:12px;text-align:center;padding:24px}
    a{color:#9fd1ff;text-decoration:none}
  </style>
</head>
<body>
  <header><h1>قائمة الطعام</h1></header>
  <div id="wrap">
    <div id="status" class="loading">جاري تحميل القائمة…</div>
    <div id="menu"></div>
  </div>
  <footer>إن ظهرت لك بيانات خام، فأنت تفتح ملف <code>menu.json</code> مباشرة. افتح <strong>menu.html</strong> بدلًا منه.</footer>

  <script>
    (async function () {
      const status = document.getElementById('status');
      const mount  = document.getElementById('menu');

      // المسار إلى ملف JSON
      const DATA_URL = 'assets/data/menu.json';

      function groupByCategory(items){
        return items.reduce((acc,it)=>{
          (acc[it.category] ??= []).push(it);
          return acc;
        },{});
      }

      function el(tag, cls, text){
        const e=document.createElement(tag);
        if(cls) e.className = cls;
        if(text) e.textContent = text;
        return e;
      }

      try{
        const res = await fetch(DATA_URL, {cache:'no-cache'});
        if(!res.ok) throw new Error('تعذّر تحميل الملف: ' + res.status);
        const data = await res.json();

        status.remove();

        const byCat = groupByCategory(data);
        const frag = document.createDocumentFragment();

        Object.keys(byCat).forEach(cat=>{
          const section = el('section','section');
          section.appendChild(el('h2',null,cat));

          const grid = el('div','grid');
          byCat[cat].forEach(item=>{
            const card = el('div','card');
            card.appendChild(el('div','title', item.title));
            card.appendChild(el('div','desc', item.desc));

            const meta = el('div','meta');
            const allergens = el('div','allergens');
            (item.allergens||[]).forEach(a=>allergens.appendChild(el('span','tag',a)));
            const price = el('div','price', item.price);
            meta.appendChild(allergens);
            meta.appendChild(price);

            card.appendChild(meta);
            grid.appendChild(card);
          });

          section.appendChild(grid);
          frag.appendChild(section);
        });

        mount.appendChild(frag);

      }catch(err){
        console.error(err);
        status.className = 'error';
        status.textContent = 'خطأ في تحميل المنيو. تأكد من وجود الملف على المسار assets/data/menu.json وأنك تفتح menu.html عبر خادم محلي.';
      }
    })();
  </script>
</body>
</html>
